<vdr-page-header>
  <vdr-page-title></vdr-page-title>
</vdr-page-header>

<vdr-page-block>
  <vdr-action-bar>
    <vdr-ab-left> </vdr-ab-left>
    <vdr-ab-right>
      <vdr-action-bar-items locationId="email-list"></vdr-action-bar-items>
      <a
        class="btn btn-primary"
        id="createbtn"
        [routerLink]="['./create']"
        *vdrIfPermissions="'CreateSettings'"
      >
        <clr-icon shape="plus"></clr-icon>
        Create New Store Credit
      </a>
    </vdr-ab-right>
  </vdr-action-bar>
</vdr-page-block>

<vdr-data-table-2
  id="affiliate-list"
  [items]="items$ | async"
  [itemsPerPage]="itemsPerPage$ | async"
  [totalItems]="totalItems$ | async"
  [currentPage]="currentPage$ | async"
  [filters]="filters"
  (pageChange)="setPageNumber($event)"
  (itemsPerPageChange)="setItemsPerPage($event)"
>
  <vdr-dt2-column [heading]="'common.id' | translate" [hiddenByDefault]="true">
    <ng-template let-storeCredit="item">
      {{ storeCredit.id }}
    </ng-template>
  </vdr-dt2-column>

  <vdr-dt2-column
    [hiddenByDefault]="true"
    [heading]="'common.created-at' | translate"
    [sort]="sorts.get('createdAt')"
  >
    <ng-template let-storeCredit="item">
      {{ storeCredit.createdAt | localeDate : 'short' }}
    </ng-template>
  </vdr-dt2-column>

  <vdr-dt2-column
    [hiddenByDefault]="true"
    [heading]="'common.updated-at' | translate"
    [sort]="sorts.get('updatedAt')"
  >
    <ng-template let-storeCredit="item">
      {{ storeCredit.updatedAt | localeDate : 'short' }}
    </ng-template>
  </vdr-dt2-column>

  <vdr-dt2-column heading="Key" [sort]="sorts.get('key')">
    <ng-template let-storeCredit="item">
      <a
        class="button-ghost"
        [routerLink]="['./', storeCredit.id]"
        *vdrIfPermissions="'UpdateSettings'"
      >
        {{ storeCredit.key }}
        <clr-icon shape="arrow right"></clr-icon>
      </a>
    </ng-template>
  </vdr-dt2-column>

  <vdr-dt2-column heading="Value" [sort]="sorts.get('value')">
    <ng-template let-storeCredit="item">
      {{ storeCredit.value }}
    </ng-template>
  </vdr-dt2-column>

  <vdr-dt2-column heading="Customer Id" [sort]="sorts.get('customerId')">
    <ng-template let-storeCredit="item">
      <ng-container
        *ngIf="
          storeCredit.customerId === undefined ||
          storeCredit.customerId === null ||
          storeCredit.customerId === ''
        "
      >
        <button class="button-ghost">
          <span>Not assigned yet</span>
          <span><clr-icon shape="empty"></clr-icon></span>
        </button>
      </ng-container>
      <ng-container *ngIf="storeCredit.customerId">
        <a class="button-ghost" [href]="getCustomerUrl(storeCredit.customerId)">
          {{ storeCredit.customerId }}
          <clr-icon shape="arrow right"></clr-icon>
        </a>
      </ng-container>
    </ng-template>
  </vdr-dt2-column>

  <vdr-dt2-column heading="Is Claimed">
    <ng-template let-storeCredit="item">
      {{ storeCredit.isClaimed }}
    </ng-template>
  </vdr-dt2-column>

  <vdr-dt2-column heading="Delete">
    <ng-template let-storeCredit="item">
      <button class="button-ghost" (click)="deleteStoreCredit(storeCredit.id)">
        <span>
          <clr-icon shape="trash"></clr-icon>
        </span>
      </button>
    </ng-template>
  </vdr-dt2-column>
</vdr-data-table-2>
